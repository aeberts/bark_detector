# Epic 1: Violation Report Generation Overhaul - Brownfield Enhancement

## Epic Goal

To completely overhaul the violation report generation system, creating a robust and reliable feature that produces professional PDF reports from `violation.json` data, decoupled from log files and aligned with the project's architecture.

## Epic Description

**Existing System Context:**

- **Current relevant functionality:** A brittle, log-based report generator (`LogBasedReportGenerator`) that is slated for deprecation. It is inefficient, tightly coupled to log file formats, and contains duplicated logic and inconsistent data models.
- **Technology stack:** Python. The new solution will introduce a PDF generation library.
- **Integration points:** The existing `--violation-report YYYY-MM-DD` CLI command and the `volations/YYYY-MM-DD_events.json` and `violations/YYYY-MM-DD_violation.json` file generated by the `--analyze-violation` command.

**Enhancement Details:**

- **What's being added/changed:** The `LogBasedReportGenerator` will be completely removed and replaced by a new, modern reporting service. This service will read data directly from the `violation.json` file produced by the `--analyze-violation` feature and generate a multi-page PDF report.
- **How it integrates:** The new service will be wired into the existing `--violation-report` CLI command. It will be responsible for orchestrating the report generation, including automatically running `--analyze-violation` if the required `violation.json` file is missing.
- **Success criteria:** A user can run `--violation-report YYYY-MM-DD` and receive a PDF file named `YYYY-MM-DD_Violation_Report.pdf` in the `reports/` directory. The content of the PDF must match the user-provided templates and handle all specified edge cases.

## Stories

1.  **Story 1: Unify Violation Data Models & Refactor Core Logic:** Refactor the codebase to use a single, consistent set of data models for violations and bark events, as recommended by the architect's analysis. This eliminates data conversion and duplicated logic.
2.  **Story 2: Implement PDF Generation Service:** Create a new service that takes a list of `Violation` objects, generates the summary and detail pages (including the visual bark intensity graph), and renders them as a single PDF file.
3.  **Story 3: Integrate Report Generator with CLI:** Wire the new PDF generation service into the `--violation-report` CLI command. Implement the error handling logic (running analysis, handling empty results) and file output specifications.

## Compatibility Requirements

- [x] The public interface of the `--analyze-violation` command must remain unchanged.
- [x] The structure of the `violation.json` file will be relied upon and should not be changed without updating the reporting service.
- [x] The `--violation-report` CLI command's signature (`--violation-report YYYY-MM-DD`) must be preserved.

## Risk Mitigation

- **Primary Risk:** The new PDF generation adds a new dependency and complexity. The visual graph generation might be difficult if bark intensity data is not readily available.
- **Mitigation:** A well-maintained, popular library for PDF generation will be chosen. For the visual graph, a default intensity will be used if the data is missing, with the clear requirement to backfill this data in the `--analyze-violation` feature later. The new implementation will be covered by a robust suite of unit and integration tests.
- **Rollback Plan:** The git history will serve as the rollback plan. The old `LogBasedReportGenerator` will be removed in the same commit that introduces the new service, and can be reverted if necessary.

## Definition of Done

- [ ] All stories completed with their acceptance criteria met.
- [ ] The old `LogBasedReportGenerator.py` file and all its related tests are deleted from the codebase.
- [ ] The new reporting service is fully integrated and functional when triggered by the `--violation-report` command.
- [ ] New unit and integration tests are written for the new reporting service.
- [ ] Project documentation is updated to reflect the new implementation.
- [ ] A sample `YYYY-MM-DD_Violation_Report.pdf` can be successfully generated.
